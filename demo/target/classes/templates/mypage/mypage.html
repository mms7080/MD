<!DOCTYPE html>
<html lang="ko" data-theme="light" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>마이페이지 – kafolio</title>

  <!-- 공통 헤더 -->
  <link rel="stylesheet" th:href="@{/css/header.css}" />
  <!-- 마이페이지 전용 -->
  <link rel="stylesheet" th:href="@{/css/mypage/mypage.css}" />
  <!-- 모달 스타일 -->
  <link rel="stylesheet" th:href="@{/css/users/auth-modal.css}" />
  <link rel="stylesheet" th:href="@{/css/mypage/mypage-modal.css}" />
</head>

<body>
  <!-- 공통 헤더 -->
  <div th:replace="fragments/header :: header('mypage')"></div>

  <!-- 본문: 좌측 레일 + 메인 -->
  <div class="admin-shell">
    <!-- 사이드바 -->
    <aside class="nav-rail">
      <div class="org-name">마이페이지</div>
      <nav class="rail-menu" id="sidebar">
        <a href="/mypage/home" class="rail-item is-active"><span class="dot"></span>홈</a>
        <a href="/mypage/team" class="rail-item"><span class="dot"></span>팀 참여 정보</a>
        <a href="#" class="rail-item"><span class="dot"></span>회원 탈퇴</a>
      </nav>
    </aside>

    <!-- 메인 -->
    <main class="page">
      <div class="page-header">
        <div class="page-titles">
          <h1>마이페이지</h1>
        </div>
      </div>

      <!-- 프로필 카드 -->
      <section class="panel profile-panel">
        <div class="profile-card">
          <div class="avatar">
            <!-- 업로드한 이미지가 있으면 사용, 없으면 기본 이미지 -->
            <img th:src="${form.profileImgUrl} ?: @{/images/avatar-default.png}" alt="프로필 이미지" />
          </div>

          <div class="who">
            <h2 th:text="${form.name}">홍길동</h2>

            <div class="email">
              <span th:text="${form.email}">hong@example.com</span>
            </div>

            <div class="github">
              <a th:href="${#strings.defaultString(form.githubUrl, '')}" target="_blank" rel="noopener">
                <span th:text="${#strings.isEmpty(form.githubUrl) ? 'Github' : 'GitHub'}"></span>
              </a>
            </div>

            <div class="positions">
              <ul class="chip-list">
                <li class="chip" th:each="pos : ${form.positions}" th:text="${pos}">empty</li>
                <li th:if="${form.positions == null or form.positions.isEmpty()}">프론트앤드</li>
              </ul>
            </div>

            <!-- 회원정보 수정 버튼 -->
            <div class="profile-actions">
              <label for="modal-edit-profile" class="btn">회원정보 수정</label>
            </div>
          </div>
        </div>
      </section>

      <!-- 현황 -->
      <section class="panel">
        <div class="panel-head">
          <h2>나의 현황</h2>
        </div>
        <div class="stat-grid">
          <!-- 포트폴리오 카드 -->
          <article class="stat-card">
            <div class="stat-top">
              <div class="stat-title">포트폴리오</div>
              <div class="stat-badge">총 개수</div>
            </div>
            <div class="stat-num">3</div>
            <ul class="recent-list">
              <li><a href="#">Landing Page 개선</a></li>
              <li><a href="#">Admin UI 디자인</a></li>
              <li><a href="#">React 프로젝트</a></li>
            </ul>
            <div class="stat-foot"><a class="link" href="#">더보기</a></div>
          </article>

          <!-- 자소서 카드 -->
          <article class="stat-card">
            <div class="stat-top">
              <div class="stat-title">자소서</div>
              <div class="stat-badge">총 개수</div>
            </div>
            <div class="stat-num">5</div>
            <ul class="recent-list">
              <li><a href="#">백엔드 개발자 지원서</a></li>
              <li><a href="#">스타트업 자기소개</a></li>
              <li><a href="#">인턴 지원용 자소서</a></li>
            </ul>
            <div class="stat-foot"><a class="link" href="#">더보기</a></div>
          </article>
        </div>
      </section>
    </main>
  </div>

  <!-- 모달 토글 -->
  <input type="checkbox" id="modal-edit-profile" />

  <!-- 회원정보 수정 모달 -->
  <div class="kf-editmodal" aria-hidden="true">
    <!-- 오버레이(클릭 시 닫힘) -->
    <label for="modal-edit-profile" class="kf-editmodal__overlay" aria-label="닫기"></label>

    <div class="kf-editmodal__dialog" role="dialog" aria-modal="true" aria-labelledby="editProfileTitle">
      <div class="kf-editmodal__header">
        <div id="editProfileTitle" class="kf-editmodal__title">회원정보 수정</div>
        <label for="modal-edit-profile" class="kf-editmodal__close" aria-label="닫기">×</label>
      </div>

      <!-- 저장 엔드포인트: /mypage/settings -->
      <form th:action="@{/mypage/settings}" method="post" enctype="multipart/form-data">
        <!-- CSRF -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <table class="kf-formtable">
          <tbody>
            <!-- 읽기 전용: 이메일 -->
            <tr>
              <th scope="row">이메일</th>
              <td>
                <input type="text" th:value="${form.email}" disabled readonly class="ro" />
                <small class="hint">이메일은 변경할 수 없습니다.</small>
              </td>
            </tr>

            <!-- 읽기 전용: 성별 -->
            <tr>
              <th scope="row">성별</th>
              <td>
                <input type="text" th:value="${form.gender}" disabled readonly class="ro" />
                <small class="hint">성별은 변경할 수 없습니다.</small>
              </td>
            </tr>

            <!-- 수정: 이름 -->
            <tr>
              <th scope="row">이름</th>
              <td>
                <input type="text" name="name" th:value="${form.name}" placeholder="이름을 입력하세요" required />
              </td>
            </tr>

            <!-- 수정: 나이 -->
            <tr>
              <th scope="row">나이</th>
              <td>
                <input type="number" name="age" th:value="${form.age}" min="0" placeholder="나이" />
              </td>
            </tr>

            <!-- 깃허브 URL -->
            <tr>
              <th scope="row">GitHub</th>
              <td>
                <input type="String" name="githubUrl" th:value="${form.githubUrl}"
                  placeholder="https://github.com/username" />
                <small class="hint">http(s):// 포함. 비우면 미표시됩니다.</small>
              </td>
            </tr>

            <!-- 프로필 이미지 업로드 -->
            <tr>
              <th scope="row">프로필 이미지</th>
              <td>
                <input type="file" name="photo" accept="image/*" />
                <!-- 업로드 안 했을 때 기존 URL 유지 -->
                <input type="hidden" name="profileImgUrl" th:value="${form.profileImgUrl}" />
              </td>
            </tr>

            <!-- 포지션(희망 직무) 복수 선택 -->
            <tr>
              <th scope="row">희망 직무</th>
              <td class="check-grid">
                <label><input type="checkbox" name="positions" value="FRONTEND"
                    th:checked="${form.positions != null and form.positions.contains('FRONTEND')}"> 프론트엔드</label>
                <label><input type="checkbox" name="positions" value="BACKEND"
                    th:checked="${form.positions != null and form.positions.contains('BACKEND')}"> 백엔드</label>
                <label><input type="checkbox" name="positions" value="FULLSTACK"
                    th:checked="${form.positions != null and form.positions.contains('FULLSTACK')}"> 풀스택</label>
                <label><input type="checkbox" name="positions" value="MOBILE"
                    th:checked="${form.positions != null and form.positions.contains('MOBILE')}"> 모바일</label>
                <label><input type="checkbox" name="positions" value="DATA"
                    th:checked="${form.positions != null and form.positions.contains('DATA')}"> 데이터/ML</label>
                <label><input type="checkbox" name="positions" value="DEVOPS"
                    th:checked="${form.positions != null and form.positions.contains('DEVOPS')}"> 데브옵스</label>
                <!-- 필요 시 QA/DESIGN/PM 등 추가 -->
                <small class="hint">최대 3개 정도를 권장합니다.</small>
              </td>
            </tr>

            <!-- 비밀번호 변경(선택) — 분리 엔드포인트 권장하지만 동폼도 가능 -->
            <tr>
              <th scope="row">비밀번호 변경</th>
              <td>
                <input type="password" name="password" placeholder="새 비밀번호 (변경 시에만 입력)" />
                <div style="height:8px"></div>
                <input type="password" name="confirmPassword" placeholder="새 비밀번호 확인" />
                <small class="hint">비워두면 기존 비밀번호를 유지합니다.</small>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="kf-editmodal__actions">
          <label for="modal-edit-profile" class="btn ghost">취소</label>
          <button type="submit" class="btn primary">저장</button>
        </div>
      </form>
    </div>
  </div>
</body>

</html>