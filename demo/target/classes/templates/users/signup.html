<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>회원가입</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; }
    form { border: 1px solid #e5e7eb; padding: 16px; border-radius: 8px; margin-bottom: 20px; }
    label { display:block; margin: 12px 0 6px; font-weight: 600; }
    input { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; }
    button { margin-top: 16px; padding: 10px 14px; border: 0; background: #111827; color: #fff; border-radius: 6px; cursor: pointer; }
    .error { color: #b91c1c; font-size: 0.9rem; margin-top: 6px; }
    .note  { color: #065f46; }
  </style>
</head>
<body>
  <h1>회원가입</h1>

  <!-- 상단 메시지 -->
  <p th:if="${msg}" th:text="${msg}" class="note"></p>
  <p th:if="${error}" th:text="${error}" class="error"></p>

  <!-- 이메일 인증코드 발송 -->
  <!-- EmailController 가 @PostMapping("/send-code") 라는 가정 -->
  <form th:action="@{/send-code}" method="post">
    <h3>이메일 인증</h3>
    <label for="emailSend">이메일</label>
    <!-- usersDTO.email 값을 유지해서 다시 안 적어도 되도록 -->
    <input id="emailSend" type="email" name="email" th:value="${usersDTO != null ? usersDTO.email : ''}" required />
    <!-- CSRF -->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">인증코드 발송</button>
    <p style="margin-top:8px;color:#6b7280;">인증코드는 5분 동안만 유효합니다.</p>
  </form>

  <!-- 회원가입 본 폼 -->
  <form th:action="@{/signup}" method="post" th:object="${usersDTO}">
    <h3>계정 정보</h3>

    <!-- (이동) 전역/필드 에러 출력: th:object 안에서 안전하게 -->
    <div th:if="${#fields.hasAnyErrors()}">
      <ul>
        <li class="error" th:each="e : ${#fields.errors('*')}" th:text="${e}">에러</li>
      </ul>
    </div>

    <label for="username">아이디</label>
    <input id="username" type="text" th:field="*{username}" placeholder="영문 소문자/숫자 4~16자" required />
    <div class="error" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>

    <label for="password">비밀번호</label>
    <input id="password" type="password" th:field="*{password}" placeholder="10자 이상" required />
    <div class="error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>

    <label for="confirmPassword">비밀번호 확인</label>
    <input id="confirmPassword" type="password" th:field="*{confirmPassword}" placeholder="비밀번호를 한번 더 입력" required />
    <div class="error" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>

    <label for="name">이름</label>
    <input id="name" type="text" th:field="*{name}" required />
    <div class="error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>

    <label for="email">이메일</label>
    <input id="email" type="email" th:field="*{email}" required />
    <div class="error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>

    <h3 style="margin-top:22px;">이메일 인증코드</h3>
    <label for="emailCode">인증코드</label>
    <!-- DTO에는 없으니 name 속성으로만 전송 -->
    <input id="emailCode" type="text" name="emailCode" placeholder="메일로 받은 6자리 코드" required />

    <!-- CSRF -->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">가입하기</button>
  </form>

  <p style="margin-top:16px;">
    이미 계정이 있으신가요? <a th:href="@{/signin}">로그인</a>
  </p>
</body>
</html>
