<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>포트폴리오 수정</title>
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/footer.css" />
  <link rel="stylesheet" href="/css/users/auth-modal.css" />
  <link rel="stylesheet" href="/css/portfolios/edit.css">
</head>
<body>
<div th:replace="fragments/modals :: authModals"></div>
<div th:replace="fragments/header :: header('portfolio')"></div>

<main class="container">
  <h1>포트폴리오 수정</h1>

  <form th:action="@{|/portfolios/${portfolioId}/edit|}"
        method="post" enctype="multipart/form-data">

    <!-- 제목 -->
    <label>제목</label>
    <input type="text" name="title" th:value="${portfolioFormDto.title}" required />

    <!-- 설명 -->
    <label>설명</label>
    <textarea name="desc" rows="4" th:text="${portfolioFormDto.desc}" required></textarea>

    <!-- 대표 이미지 -->
    <label>대표 이미지</label>
    <div class="cover-preview" th:if="${portfolioFormDto.coverPath} != null">
      <img th:src="${portfolioFormDto.coverPath}" alt="기존 대표 이미지" class="cover-thumb" />
    </div>
    <input type="file" name="cover" id="cover-input" accept=".jpg,.jpeg,.png,.webp" />
    <div id="cover-preview" class="cover-preview"></div>

    <!-- 팀명 -->
    <label>팀명</label>
    <input type="text" name="teamName" th:value="${portfolioFormDto.teamName}" placeholder="팀명" required />

    <!-- 팀원 & 역할 -->
    <label>팀원 & 역할</label>
    <div id="team-list">
      <div class="team-item" th:each="member, iter : ${portfolioFormDto.team}">
        <input type="hidden" th:name="|team[${iter.index}].id|" th:value="${member.id}" />

        <input type="text" th:name="|team[${iter.index}].memberName|"
               th:value="${member.memberName}" placeholder="팀원 이름" required />
        <select th:name="|team[${iter.index}].memberRole|">
          <option value="팀장" th:selected="${member.memberRole == '팀장'}">팀장</option>
          <option value="팀원" th:selected="${member.memberRole == '팀원'}">팀원</option>
        </select>
        <input type="text" th:name="|team[${iter.index}].parts|"
               th:value="${member.parts}" placeholder="담당 기능/페이지" />

        <button type="button" class="btn-mini danger" onclick="removeTeam(this)">삭제</button>
      </div>
    </div>
    <button type="button" onclick="addTeam()">+ 팀원 추가</button>

    <!-- 프로젝트 이미지 -->
    <label>프로젝트 이미지</label>
    <div th:if="${portfolioFormDto.screenshotPaths != null and !portfolioFormDto.screenshotPaths.isEmpty()}">
      <div class="image-preview">
        <img th:each="img : ${portfolioFormDto.screenshotPaths}"
             th:if="${img != null}"
             th:src="@{${img}}"
             th:alt="${img != null ? '스크린샷: ' + img : '이미지 없음'}"
             class="thumb"/>
      </div>
    </div>

    <input type="file" name="screenshots" id="image-input" multiple accept=".jpg,.jpeg,.png,.webp" />
    <div id="image-preview" class="image-preview"></div>

    <!-- 아이콘 -->
    <label>프로젝트 아이콘</label>
    <div class="icon-preview" th:if="${portfolioFormDto.iconPath} != null">
      <img th:src="${portfolioFormDto.iconPath}" alt="기존 아이콘" class="icon-thumb"/>
    </div>

    <input type="file" name="icon" id="icon-input" accept=".jpg,.jpeg,.png,.webp" />
    <div id="icon-preview" class="icon-preview"></div>

    <!-- 태그 -->
    <label>태그</label>
    <div class="tag-input-box">
      <input type="text" id="tag-input" placeholder="예: React" />
      <button type="button" onclick="addTag()">+ 추가</button>
    </div>
    <div id="tag-list">
      <div th:each="tag : ${portfolioFormDto.tags}" class="tag-item" th:text="${tag}"></div>
    </div>
    
    <div id="tags-hidden-box"></div>

    <!-- ZIP -->
    <label>다운로드 ZIP 파일</label>
    <div th:if="${portfolioFormDto.downloadPath} != null">
      <a th:href="${portfolioFormDto.downloadPath}" download>기존 ZIP 다운로드</a>
    </div>
    <input type="file" name="download" accept=".zip" />

    <!-- 링크 -->
    <label>홈페이지 주소</label>
    <input type="url" name="link" th:value="${portfolioFormDto.link}" placeholder="https://..." />

    <!-- 저장/취소 -->
    <div class="form-actions">
      <button type="submit" class="btn-save">저장</button>
      <button type="button" class="btn-cancel" onclick="goToList()">취소</button>
    </div>
  </form>
</main>

<script src="/js/portfolios/portfolios-create.js"></script>
<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
