<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title th:text="${portfolios != null} ? portfolios.title : '포트폴리오 없음'">Portfolio</title>
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />

  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/portfolios/portfolios-detail.css">
</head>
<body class="portfolio-detail">
  <!-- 헤더 -->
  <div th:replace="fragments/header :: header"></div>

<main class="container">

  <!-- ❌ Not Found -->
  <div th:if="${notFound}" class="error-box">
    <h1>포트폴리오를 찾을 수 없습니다.</h1>
    <a href="/home">← 홈으로</a>
  </div>

  <!-- ✅ Portfolio Content -->
  <div th:if="${portfolios != null}" class="portfolio-detail-grid">

    <!-- 왼쪽: 이미지 -->
    <div class="gallery">
      <!-- 대표 이미지 -->
      <figure class="main-photo">
        <img id="mainImage" th:src="${portfolios.screenshots[0]}" alt="대표 이미지">
      </figure>

      <!-- 썸네일 -->
      <div class="thumb-list">
        <img th:each="img : ${portfolios.screenshots}"
             th:src="${img}"
             alt="썸네일"
             onmouseover="changeMainImage(this.src)">
      </div>
    </div>

    <!-- 오른쪽: 정보 -->
    <div class="info-box">
      <h1 class="title" th:text="${portfolios.title}">제목</h1>
      <p class="desc" th:text="${portfolios.desc}">설명</p>

      <div class="meta-box">

        <p><span class="label">Link:</span>
          <a th:href="${portfolios.link}" target="_blank" th:text="${portfolios.link}" class="custom-link"></a>
        </p>

        <p><span class="label">Views:</span> <span id="viewCount">0</span></p>

        <div class="like-wrap">
          <!-- 로그인 상태일 때 -->
          <button sec:authorize="isAuthenticated()"
                  id="likeBtn"
                  class="heart-btn"
                  title="좋아요"
                  aria-label="좋아요"
                  th:attr="data-id=${portfolios.id}">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                 stroke-width="1.5" stroke="currentColor" class="heart-icon">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 
                       0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 
                       3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
            </svg>
            <span id="likeCount" th:text="${portfolios.likes}">0</span>
          </button>
        
          <!-- 비로그인 상태일 때 -->
          <a sec:authorize="isAnonymous()"
          href="/signin"
          id="likeSigninTrigger"
          class="like-btn"
          title="로그인 후 좋아요 가능">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor" class="heart-icon">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 
                    0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 
                    3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
          </svg>
          <span th:text="${portfolios.likes}">0</span>
          </a>

        </div>
        

        <!-- 🏷 태그 -->
        <div class="tags">
          <span class="label">Tags:</span>
          <div class="tag-wrap">
            <a th:each="tag : ${portfolios.tags}"
               th:href="@{/home(q=${tag})}"
               th:text="${tag}"
               class="tag"></a>
          </div>
        </div>

        <!-- 다운로드 -->
        <p><span class="label">Download:</span>
          <a th:href="${portfolios.download}" download th:text="${portfolios.download}" class="download-link"></a>
        </p>

        <!-- 아이콘 -->
        <aside class="summary-logo" th:if="${portfolios.icon}">
          <figure class="logo-card" title="portfolios Logo">
            <img th:src="${portfolios.icon}"
                 th:alt="|${portfolios.title} 아이콘|"
                 loading="lazy" decoding="async">
          </figure>
        </aside>
      </div>

      
    </div>
  </div>

  
 

  <div class="comment-section">
  <h2>댓글</h2>

  <!-- 평균 별점(모두에게 보임) -->
  <div class="rating-summary">
    <div class="stars readonly" id="avgStars" aria-label="평균 별점"></div>
    <span class="star-symbol">⭐</span>
    <span id="avgScore">0.0</span>
    <span class="count">(<span id="ratingCount">0</span>)</span>
  </div>

  <!-- 로그인 사용자 전용: 별점 + 댓글 폼 -->
  <div sec:authorize="isAuthenticated()">
    <div class="rate-input">
      <label class="rate-label">내 별점: </label>
      <div id="writeStars" class="stars write" role="radiogroup" aria-label="별점 선택(1~5)">
        <!-- JS가 5개 별을 만들어줍니다 -->
      </div>
      <span id="myScoreText">0</span>/5
    </div>

    <form id="commentForm">
      <textarea id="commentContent" placeholder="댓글을 입력하세요..." rows="4" required></textarea>
      <button type="submit">등록</button>
    </form>
  </div>

  <!-- 비회원 안내 -->
  <div sec:authorize="isAnonymous()">
    <p class="muted">로그인 후 댓글/별점을 남길 수 있습니다. <a href="/signin">로그인</a></p>
  </div>

  <!-- 댓글 리스트 -->
  <div id="commentList" class="comments"></div>
</div>


<!-- 로그인 필요 모달 -->
<div id="loginModal" class="login-modal" hidden>
  <div class="modal-content">
    <p>로그인이 필요한 서비스입니다.</p>
    <button id="goSigninBtn">확인</button>
  </div>
</div>

</main>

<!-- 🔗 JavaScript -->
<script>
  function changeMainImage(src) {
    document.getElementById("mainImage").src = src;
  }
</script>
<script src="/js/portfolios/portfolios-detail.js"></script>
</body>
</html>
