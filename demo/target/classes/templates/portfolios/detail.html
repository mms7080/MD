<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title th:text="${portfolio != null} ? ${portfolio.title} : 'Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏóÜÏùå'">Portfolio</title>

        <meta name="_csrf" th:content="${_csrf.token}" />
        <meta name="_csrf_header" th:content="${_csrf.headerName}" />

        <link rel="stylesheet" href="/css/header.css" />
        <link rel="stylesheet" href="/css/footer.css" />
        <link rel="stylesheet" href="/css/users/auth-modal.css" />
        <link rel="stylesheet" href="/css/portfolios/detail.css" />
    </head>
    <body class="portfolio-detail">
        <!-- Ìó§Îçî -->
        <div th:replace="fragments/modals :: authModals"></div>
        <div th:replace="fragments/header :: header('portfolio')"></div>

        <main class="container">
            <!-- ‚ùå Not Found -->
            <div th:if="${notFound}" class="error-box">
                <h1>Ìè¨Ìä∏Ìè¥Î¶¨Ïò§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.</h1>
                <a href="/home">‚Üê ÌôàÏúºÎ°ú</a>
            </div>
             <!-- ‚úÖ ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº (ADMIN Ï†ÑÏö©, Ìó§Îçî ÏïÑÎûò Ïö∞Ï∏°) -->
             <div class="detail-admin-actions" sec:authorize="hasRole('ADMIN')">
                
                <!-- ÏàòÏ†ï Î≤ÑÌäº (Uiverse.io Ïä§ÌÉÄÏùº) -->
                <a th:href="@{|/portfolios/edit/${portfolio.id}|}">
                    <button class="edit-btn">edit
                        
                    </button>
                </a>
                <button type=button class="edit-btn" onclick="openDeleteModal()">delete
                    
                </button>
        
            <!-- ÏÇ≠Ï†ú Î≤ÑÌäº (Î™®Îã¨ Ïó¥Í∏∞Ïö©) -->
        
        </div>
            
            <div class="center-box">
                <div class="title-row">
                    <h1 class="title">
                        <a
                            th:href="${portfolio.link}"
                            target="_blank"
                            th:text="${portfolio.title}"
                            >Ï†úÎ™©</a
                        >
                    </h1>
                   
                </div>
                <p class="desc" th:if="${portfolio.desc != null}" th:text="${portfolio.desc}"></p>
            </div>
            
            <!-- ‚úÖ Portfolio Content -->
            <div th:if="${portfolio != null}" class="portfolio-detail-grid">
                <!-- ÏôºÏ™Ω: Ïù¥ÎØ∏ÏßÄ -->
                <div class="gallery">
                 <!-- ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ -->
                 <figure class="main-photo" 
                        th:if="${portfolio.screenshots != null and !portfolio.screenshots.isEmpty()}">
                        <img id="mainImage"
                        th:src="@{${portfolio.screenshots[0]}}"
                        alt="ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ"
                        onclick="openModal(0)" />
                </figure>
                

                <!-- Ïç∏ÎÑ§Ïùº Î™©Î°ù -->
                <!-- Ïç∏ÎÑ§Ïùº Î™©Î°ù (Ï≤´ Î≤àÏß∏ Ï†úÏô∏) -->
            <div class="thumb-list"
                    th:if="${portfolio.screenshots != null and portfolio.screenshots.size() > 1}">
                    <img th:each="img, iter : ${portfolio.screenshots}"
                    th:if="${iter.index > 0}"
                    th:src="@{${img}}"
                    th:attr="data-index=${iter.index}, onclick='openModal(' + ${iter.index} + ')'"
                    alt="Ïç∏ÎÑ§Ïùº"
                    class="thumb"/>
            </div>



                </div>

                <!-- üìå Î™®Îã¨ -->
                <div id="imageModal" class="modal">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <img class="modal-content" id="modalImage" />
                    <a class="prev" onclick="changeImage(-1)">&#10094;</a>
                    <a class="next" onclick="changeImage(1)">&#10095;</a>
                </div>

                <!-- Ïò§Î•∏Ï™Ω: Ï†ïÎ≥¥ -->
                <div class="info-box" th:if="${portfolio.team != null and !portfolio.team.isEmpty()}">
                    <h2>ÌåÄÏõê & Ïó≠Ìï†</h2>
                    <!-- ÌåÄÏõê Ï∂úÎ†• -->
                    <ul class="team-list">
                        <li class="team-item" th:each="member : ${portfolio.team}">
                            <div class="team-name">
                                <strong th:text="${member.memberName}">ÌåÄÏõê Ïù¥Î¶Ñ</strong>
                                <span class="role" th:text="${member.memberRole}">Ïó≠Ìï†</span>
                            </div>
                            <p class="parts" th:text="${member.parts}">Îã¥Îãπ Í∏∞Îä•</p>
                        </li>
                    </ul>
                </div>

                </div>
            </div>
            <div class="icon-bar">
                <div class="icon-left">
                    <!-- Views -->
                    <!-- Views -->
                    <span class="view-box" title="Ï°∞ÌöåÏàò">
                        <i class="fa-solid fa-eye"></i>
                        <span class="view-label">Views :</span>
                        <span id="viewCount" th:attr="data-id=${portfolio.id}" th:text="${portfolio.viewCount}">0</span>
                      </span>

                    <!-- Tags -->
<span class="tags-box" title="ÌÉúÍ∑∏">
    <i class="fa-solid fa-tags"></i>
    <span class="tags-label">Tags :</span>
    <span class="tags-list">
      <a th:each="tag : ${portfolio.tags}"
         th:href="@{|/portfolios?tag=${tag}|}" 
         class="tag-item"
         th:text="${tag}">Tag</a>
    </span>
    <button type="button" class="tag-more-btn" onclick="toggleTags(this)" data-expanded="false">+ ÎçîÎ≥¥Í∏∞</button>
  </span>
                      
                      

                </div>

                <div class="icon-right">
                    <!-- Heart (Ï¢ãÏïÑÏöî) -->

                    <!-- Uiverse.io Heart -->
                    <div class="heart-container" title="Like">
                        <input type="checkbox" class="checkbox" id="likeBtn" />
                        <div class="svg-container">
                            <svg
                                viewBox="0 0 24 24"
                                class="svg-outline"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,11,8.967a1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,22,8.967C22,11.87,19.053,16.006,13.915,20.313Z"
                                ></path>
                            </svg>
                            <svg
                                viewBox="0 0 24 24"
                                class="svg-filled"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Z"
                                ></path>
                            </svg>
                            <svg
                                class="svg-celebrate"
                                width="100"
                                height="100"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <polygon points="10,10 20,20"></polygon>
                                <polygon points="10,50 20,50"></polygon>
                                <polygon points="20,80 30,70"></polygon>
                                <polygon points="90,10 80,20"></polygon>
                                <polygon points="90,50 80,50"></polygon>
                                <polygon points="80,80 70,70"></polygon>
                            </svg>
                        </div>
                    </div>

                    <!-- Ï¢ãÏïÑÏöî Ïπ¥Ïö¥Ìä∏ -->
                    <span id="likeCount">0</span>

                    <!-- Download -->
                    <a th:if="${portfolio.download != null}" 
                        th:href="@{${portfolio.download}}"
                        download class="Btn" title="Download">

                        <svg
                            class="svgIcon"
                            viewBox="0 0 384 512"
                            height="1em"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 
                                0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32v306.7L54.6 
                                265.4c-12.5-12.5 -32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"
                            ></path>
                        </svg>
                        <span class="icon2"></span>
                        <span class="tooltip"></span>
                    </a>
                    <!-- Link -->
                    <a
                        th:href="${portfolio.link}"
                        target="_blank"
                        title="Link"
                        class="icon-link"
                    >
                    <img th:if="${portfolio.icon != null}" th:src="@{${portfolio.icon}}" 
                        alt="ÌôàÌéòÏù¥ÏßÄ ÏïÑÏù¥ÏΩò" 
                        class="link-icon"/>
                    </a>
                </div>
            </div>

            <div class="comment-section">
                <h2>Comments</h2>
            
                <!-- ÌèâÍ∑† Î≥ÑÏ†ê -->
                <div class="rating-summary">
                    <span class="avg-label">ÌèâÍ∑† Î≥ÑÏ†ê:</span>
                    <span th:text="${#numbers.formatDecimal(avgRating, 1, 1)}">0.0</span> Ï†ê
                    <span class="count">(<span th:text="${ratingCount}">0</span>Í∞ú)</span>
                  </div>
</div>
            
                <!-- Î°úÍ∑∏Ïù∏ ÏÇ¨Ïö©Ïûê -->
                <div sec:authorize="isAuthenticated()">
                    <form th:action="@{|/portfolios/${portfolio.id}/comments|}" method="post" class="comment-form">
                        <div class="rate-input">
                            <label class="rate-label">Î≥ÑÏ†ê:</label>
                            <div class="rating">
                                <input type="radio" name="rating" value="5" id="star5" required>
                                <label for="star5" title="5Ï†ê"></label>
            
                                <input type="radio" name="rating" value="4" id="star4">
                                <label for="star4" title="4Ï†ê"></label>
            
                                <input type="radio" name="rating" value="3" id="star3">
                                <label for="star3" title="3Ï†ê"></label>
            
                                <input type="radio" name="rating" value="2" id="star2">
                                <label for="star2" title="2Ï†ê"></label>
            
                                <input type="radio" name="rating" value="1" id="star1">
                                <label for="star1" title="1Ï†ê"></label>
                            </div>
                        </div>
                        <input type="text" name="content" placeholder="Ìïú Ï§Ñ ÌèâÍ∞ÄÎ•º ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî..." required>
                        <button type="submit">Îì±Î°ù</button>
                    </form>
                </div>
            
                <!-- ÎπÑÌöåÏõê ÏïàÎÇ¥ -->
                <div sec:authorize="isAnonymous()" class="login-prompt">
                    <p class="muted">
                        Î°úÍ∑∏Ïù∏ ÌõÑ ÎåìÍ∏Ä/Î≥ÑÏ†êÏùÑ ÎÇ®Í∏∏ Ïàò ÏûàÏäµÎãàÎã§.
                        <label for="modal-signin" class="login-btn">Î°úÍ∑∏Ïù∏</label>
                    </p>
                </div>
            
                <div id="commentList" class="comments" sec:authorize="isAuthenticated()">
                    <div class="comment" 
                        th:each="comment : ${comments}" 
                        th:classappend="${#authentication.name == comment.user.username} ? ' mine'">
  
                <!-- Î©îÌÉÄ (ÏûëÏÑ±Ïûê, ÎÇ†Ïßú, ÏàòÏ†ï/ÏÇ≠Ï†ú) -->
                <div class="meta">
                    <div class="left-box">
                    <span class="author">ÏùµÎ™Ö</span>
                    <!-- ‚≠ê Î≥ÑÏ†ê: ÏùµÎ™Ö Î∞ëÏóê Ìïú Ï§Ñ -->
                    <!-- Î≥ÑÏ†ê Î∏îÎ°ù (ÏùµÎ™Ö ÏïÑÎûò) -->
                <!-- ÎåìÍ∏Ä Î≥ÑÏ†ê -->
                <div class="stars readonly" th:attr="data-rating=${comment.rating}"></div>
                    </div>
                
                    <div class="right-box">
                    <span class="date" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd')}"></span>
                    <div class="comment-actions"
                        sec:authorize="hasRole('ADMIN') or #authentication.name == comment.user.username">
                        <button type="button" class="btn-mini" onclick="enableEdit(this)">ÏàòÏ†ï</button>
                        <form th:action="@{|/portfolios/${portfolio.id}/comments/${comment.id}/delete|}" 
                            method="post" class="delete-form"
                            onsubmit="return confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');">
                        <input type="hidden" name="_csrf" th:value="${_csrf.token}">
                        <button type="submit" class="btn-mini danger">ÏÇ≠Ï†ú</button>
                        </form>
                    </div>
                    </div>
                </div>
                
                <!-- üí¨ ÎåìÍ∏Ä Î≥∏Î¨∏ -->
                <p class="content" th:text="${comment.content}"></p>
                

                <!-- ‚úçÔ∏è Ïù∏ÎùºÏù∏ ÏàòÏ†ï Ìèº -->
                <form th:action="@{|/portfolios/${portfolio.id}/comments/${comment.id}/edit|}" 
                        method="post" class="edit-form" style="display:none;"
                        sec:authorize="hasRole('ADMIN') or #authentication.name == comment.user.username">
                        <!-- ÎåìÍ∏Ä ÏàòÏ†ïÌèº Î≥ÑÏ†ê -->
<div class="rating edit-rating">
    <input type="radio" name="rating" value="5" id="edit-star5-[[${comment.id}]]">
    <label for="edit-star5-[[${comment.id}]]">‚òÖ</label>
  
    <input type="radio" name="rating" value="4" id="edit-star4-[[${comment.id}]]">
    <label for="edit-star4-[[${comment.id}]]">‚òÖ</label>
  
    <input type="radio" name="rating" value="3" id="edit-star3-[[${comment.id}]]">
    <label for="edit-star3-[[${comment.id}]]">‚òÖ</label>
  
    <input type="radio" name="rating" value="2" id="edit-star2-[[${comment.id}]]">
    <label for="edit-star2-[[${comment.id}]]">‚òÖ</label>
  
    <input type="radio" name="rating" value="1" id="edit-star1-[[${comment.id}]]">
    <label for="edit-star1-[[${comment.id}]]">‚òÖ</label>
  </div>
  
                    <textarea name="content" rows="2"></textarea>
                    <input type="hidden" name="_csrf" th:value="${_csrf.token}">
                    <button type="submit" class="btn-save">Ï†ÄÏû•</button>
                    <button type="button" class="btn-cancel" onclick="cancelEdit(this)">Ï∑®ÏÜå</button>
                </form>
                </div>

                  </div>
                  <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
                  <div class="pagination" th:if="${totalPages > 1}">
                    <ul>
                        <li th:each="i : ${#numbers.sequence(0, totalPages-1)}"
                            th:classappend="${i == currentPage} ? 'active'">
                            <a th:href="@{|/portfolios/${portfolio.id}?page=${i}|}" th:text="${i + 1}"></a>
                        </li>
                    </ul>
                </div>
                  
                
            </div>
            

            <!-- ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏ -->
        </main>

        
            <!-- ÏÇ≠Ï†ú Î™®Îã¨ -->
            <div id="deleteModal" class="modal" style="display:none;">
                <div class="modal-content">
                    <p>Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
                    <div class="modal-actions">
                        <!-- ‚úÖ ÌôïÏù∏ Î≤ÑÌäº: Ïã§Ï†ú ÏÇ≠Ï†ú Ìèº Ï†úÏ∂ú -->
                        <form id="deleteForm" th:action="@{|/portfolios/delete/${portfolio.id}|}" method="post">
                            <input type="hidden" name="_csrf" th:value="${_csrf.token}" />
                            <button type="submit" class="btn-confirm">ÌôïÏù∏</button>
                            <!-- Ï∑®ÏÜå Î≤ÑÌäº -->
                        <button type="button" class="btn-confirm" onclick="closeDeleteModal()">Ï∑®ÏÜå</button>
                        </form>
                        
                        
                    </div>
                </div>
            </div>

        <!-- üîó JavaScript -->
        <script>
            function changeMainImage(src) {
                document.getElementById("mainImage").src = src;
            }
        </script>
        <script src="/js/portfolios/portfolios-detail.js"></script>
        <div th:replace="fragments/footer :: footer"></div>
    </body>
</html>
