<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="authModals">
  <div class="modal-root">
    <!-- CSS-only 토글 라디오 (기본 닫힘) -->
    <input type="radio" name="modal" id="modal-none" hidden checked>
    <input type="radio" name="modal" id="modal-signin" hidden>
    <input type="radio" name="modal" id="modal-signup" hidden>

    <script th:src="@{/js/users/sign.js}" defer></script>

    <!-- 로그인 모달 -->
    <div class="kf-auth-modal signin" role="dialog" aria-modal="true" aria-labelledby="signin-title">
      <label class="kf-auth__overlay" for="modal-none"></label>
      <div class="kf-auth__content">
        <label class="kf-auth__close" for="modal-none" aria-label="닫기">×</label>

        <div class="kf-auth__grid">
          <aside class="auth-left">
            <div class="auth-left__inner">
              <p class="auth-welcome">Welcome!</p>
              <div class="brand-title">kafolio</div>
              <p class="brand-sub">portfolio gallery</p>
              <p class="auth-cta">Not a member yet?
                <label class="link" for="modal-signup">Register now</label>
              </p>
            </div>
          </aside>

          <section class="auth-right">
            <h3 id="signin-title" class="auth-title">Log in</h3>

            <form class="auth-form" th:action="@{/signin}" method="post" aria-label="로그인 폼">
              <label class="auth-field">
                <span class="auth-label">EMAIL OR USERNAME</span>
                <input name="username" type="text" placeholder="아이디 또는 이메일" required autocomplete="username">
              </label>

              <label class="auth-field">
                <span class="auth-label">PASSWORD</span>
                <input name="password" type="password" placeholder="비밀번호" required autocomplete="current-password">
              </label>

              <label class="auth-keep">
                <input type="checkbox" name="remember-me">
                <span>로그인 상태 유지</span>
              </label>

              <!-- CSRF -->
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

              <button type="submit" class="auth-btn">Log in now</button>

              <div class="auth-row">
                <a class="link small" th:href="@{/forgot}">Forgot your password?</a>
              </div>

              <p class="kf-switch">계정이 없나요?
                <label for="modal-signup" class="link">회원가입</label>
              </p>
            </form>
          </section>
        </div>
      </div>
    </div>

    <!-- 회원가입 모달 -->
    <div class="kf-auth-modal signup" role="dialog" aria-modal="true" aria-labelledby="signup-title">
      <label class="kf-auth__overlay" for="modal-none"></label>
      <div class="kf-auth__content">
        <label class="kf-auth__close" for="modal-none" aria-label="닫기">×</label>

        <div class="kf-auth__grid">
          <aside class="auth-left">
            <div class="auth-left__inner">
              <p class="auth-welcome">Join us</p>
              <div class="brand-title">kafolio</div>
              <p class="brand-sub">portfolio gallery</p>
              <p class="auth-cta">Already have an account?
                <label class="link" for="modal-signin">Log in</label>
              </p>
            </div>
          </aside>

          <section class="auth-right">
            <h3 id="signup-title" class="auth-title">Sign up</h3>

            <form class="auth-form" th:action="@{/signup}" method="post" aria-label="회원가입 폼" novalidate>
              <!-- 아이디 + 중복확인 -->
              <label class="auth-field">
                <span class="auth-label">아이디</span>
                <div class="row-2">
                  <input id="username" name="username" type="text" placeholder="영문/숫자 4~16자" required autocomplete="username">
                  <button type="button" class="btn" id="btnCheckId">중복 확인</button>
                </div>
                <small id="usernameStatus" class="note-banner" hidden></small>
              </label>

              <!-- 비밀번호 / 비밀번호 확인 -->
              <div class="row-2">
                <label class="auth-field">
                  <span class="auth-label">비밀번호</span>
                  <input name="password" type="password" placeholder="10자 이상" required autocomplete="new-password">
                </label>
                <label class="auth-field">
                  <span class="auth-label">비밀번호 확인</span>
                  <input name="confirmPassword" type="password" placeholder="비밀번호 재입력" required autocomplete="new-password">
                </label>
              </div>

              <!-- 이름 -->
              <label class="auth-field">
                <span class="auth-label">이름</span>
                <input name="name" type="text" placeholder="홍길동" required>
              </label>

              <!-- 이메일 + 인증코드 (항상 보임) -->
              <div class="auth-field" id="emailCombo">
                <span class="auth-label">이메일 <span class="req" aria-hidden="true">*</span></span>

                <div class="email-combo">
                  <input id="emailLocal" name="emailLocal" type="text" placeholder="아이디" autocomplete="off" />
                  <span class="at">@</span>

                  <div class="domain-wrap">
                    <select id="emailDomain" name="emailDomainSel" aria-label="도메인 선택">
                      <option value="gmail.com">gmail.com</option>
                      <option value="naver.com">naver.com</option>
                      <option value="daum.net">daum.net</option>
                      <option value="kakao.com">kakao.com</option>
                      <option value="__custom__">직접 입력</option>
                    </select>
                    <input id="emailDomainCustom" name="emailDomainCustom" type="text" placeholder="example.com" class="hidden" />
                  </div>

                  <!-- 실제 전송될 이메일 값 -->
                  <input id="email" name="email" type="hidden" />

                  <!-- 발송 버튼 -->
                  <button type="button" class="btn small" id="btnSendCode">인증코드 발송</button>
                </div>

                <!-- ✅ 인증코드 입력 블록: 항상 보이게 -->
                <div class="code-block" id="codeBlock">
                  <input id="emailCode" name="emailCode" type="text" inputmode="numeric" pattern="\d{6}" maxlength="6"
                         placeholder="인증코드 6자리" aria-label="이메일 인증코드" />
                  <button type="button" class="btn" id="btnVerifyCode">코드 확인</button>
                </div>

                <!-- AJAX 상태 메시지 -->
                <small class="note-banner" id="ajaxNotice" hidden aria-live="polite"></small>
              </div>

              <!-- 성별 + 생년월일 -->
              <div class="row-2">
                <fieldset class="auth-field">
                  <legend class="auth-label">성별</legend>
                  <div class="radios">
                    <label class="radio"><input type="radio" name="gender" value="M" required><span>남자</span></label>
                    <label class="radio"><input type="radio" name="gender" value="W" required><span>여자</span></label>
                  </div>
                </fieldset>

                <label class="auth-field">
                  <span class="auth-label">생년월일</span>
                  <input id="birth" name="birth" type="date" placeholder="YYYY-MM-DD" required>
                  <input id="ageHidden" name="age" type="hidden">
                </label>
              </div>

              <!-- CSRF -->
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

              <button type="submit" class="auth-btn">회원가입</button>

              <p class="kf-switch">이미 계정이 있나요?
                <label for="modal-signin" class="link">로그인</label>
              </p>
            </form>
          </section>
        </div>
      </div>
    </div>
  </div>
</th:block>
