<!DOCTYPE html>
<html lang="ko" th:replace="~{fragments/layout :: body(title='Folio 상세', active='folios')}">
<head>
    <meta charset="UTF-8">
    <title>Folio 상세</title>
</head>
<body>
    <div id="folio-detail-container">
        <p class="loading-message muted">상세 정보를 불러오는 중입니다...</p>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // URL에서 folioId를 추출합니다.
            const folioId = /*[[${folioId}]]*/ 'default-id';
            const container = document.getElementById('folio-detail-container');

            // API에 상세 데이터를 요청합니다.
            fetch(`/api/folios/${folioId}`)
                .then(response => {
                    if (response.status === 404) {
                        throw new Error('해당 소개서를 찾을 수 없습니다.');
                    }
                    if (!response.ok) {
                        throw new Error('데이터를 불러오는데 실패했습니다.');
                    }
                    return response.json();
                })
                .then(data => {
                    // 기술 스택, 포트폴리오, 사진 목록 HTML을 미리 생성합니다.
                    const skillsHtml = data.skills.map(skill => `<span class="tag">${skill}</span>`).join('');
                    const projectsHtml = data.projects.map(p => `<li><a href="/portfolios/${p.portfolioId}">${p.title}</a></li>`).join('');
                    const photosHtml = data.photos.map(photoUrl => `<img src="${photoUrl}" alt="소개 이미지" style="max-width: 100%; border-radius: 8px;">`).join('');

                    // 전체 상세 페이지 HTML을 구성합니다.
                    const detailHtml = `
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-top: 2rem;">
                            <div class="pane">
                                <img src="${data.photos[0]}" alt="대표 이미지" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem;">
                                <h2 style="margin: 0 0 0.5rem;">${data.user.userName}</h2>
                                <p class="muted">@${data.user.id}</p>
                                <hr style="border-color: var(--line); margin: 1rem 0;">
                                <h4>기술 스택</h4>
                                <div class="tags" style="margin-top: 0.5rem;">${skillsHtml}</div>
                            </div>

                            <div class="pane">
                                <h3>자기소개</h3>
                                <p>${data.introduction}</p>
                                <hr style="border-color: var(--line); margin: 1.5rem 0;">
                                <h3>참여한 포트폴리오</h3>
                                <ul style="list-style: none; padding: 0;">${projectsHtml}</ul>
                                <hr style="border-color: var(--line); margin: 1.5rem 0;">
                                <h3>사진</h3>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    ${photosHtml}
                                </div>
                            </div>
                        </div>
                    `;
                    // 로딩 메시지를 지우고, 생성된 HTML을 컨테이너에 삽입합니다.
                    container.innerHTML = detailHtml;
                })
                .catch(error => {
                    container.innerHTML = `<p class="muted" style="color: red;">오류: ${error.message}</p>`;
                    console.error('Fetch Error:', error);
                });
        });
    </script>
</body>
</html>