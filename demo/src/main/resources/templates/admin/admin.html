<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê´€ë¦¬ì í˜ì´ì§€ â€“ kafolio</title>

  <!-- ê³µí†µ í—¤ë” ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="/css/header.css" />
  <!-- ê´€ë¦¬ì ë””ìì¸ CSS (rail/page/panel/table ë“±) -->
  <link rel="stylesheet" href="/css/admin/admin.css" />
</head>
<body>
  <!-- ê³µí†µ í—¤ë” -->
<div th:replace="fragments/header :: site-header"></div>


  <!-- ë³¸ë¬¸: ì¢Œì¸¡ ë ˆì¼ + í˜ì´ì§€ -->
  <div class="admin-shell">
    <!-- ì‚¬ì´ë“œë°”(ë ˆì¼) -->
    <aside class="nav-rail">
      <div class="org-name">ê´€ë¦¬ì</div>
      <nav class="rail-menu" id="sidebar">
        <a href="#" class="rail-item is-active" data-page="folice"><span class="dot"></span> Folice ê´€ë¦¬</a>
        <a href="#" class="rail-item" data-page="profolios"><span class="dot"></span> í¬í† í´ë¦¬ì˜¤ ê´€ë¦¬</a>
        <a href="#" class="rail-item" data-page="teams"><span class="dot"></span> íŒ€ ê´€ë¦¬</a>
        <a href="#" class="rail-item" data-page="users"><span class="dot"></span> ìœ ì € ê´€ë¦¬</a>
      </nav>
    </aside>

    <!-- Page Area -->
    <main class="page">
      <div class="page-header">
        <div class="page-titles">
          <h1 id="pageTitle">Folice ê´€ë¦¬</h1>
          <p class="sub" id="pageSub">íŒŒì¼/ë°°ë„ˆ ë“± Folice ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
        </div>
        <!-- âœ… ìƒë‹¨ primary ë²„íŠ¼(íŒ€ ì €ì¥) ì œê±°ë¨ -->
      </div>

      <!-- ì»¨í…ì¸  íŒ¨ë„ -->
      <section class="panel">
        <div class="panel-head">
          <h2 id="panelTitle">Folice ëª©ë¡</h2>
          <span class="count" id="panelCount">0ê±´</span>
        </div>

        <!-- ë™ì  ì»¨í…ì¸  ë“¤ì–´ê°ˆ ê³³ -->
        <div id="panelBody" class="table-wrap"></div>

        <div class="panel-foot" id="panelFoot" style="display:none">
          <span class="hint" id="rangeHint">0ê±´ í‘œì‹œ</span>
          <div class="pager">
            <button class="pager-btn" id="prevPage" aria-label="ì´ì „">â€¹</button>
            <span class="pager-page is-current" id="pageIndex">1</span>
            <button class="pager-btn" id="nextPage" aria-label="ë‹¤ìŒ">â€º</button>
          </div>
        </div>
      </section>
    </main>
  </div>

<script>
/* ------------------ ë”ë¯¸ ë°ì´í„° ------------------ */
const allMembers = [
  { id: 1,  name: "ë°•ë²”ìˆ˜" }, { id: 2,  name: "ê¹€ì² ìˆ˜" }, { id: 3,  name: "ì´ì˜í¬" },
  { id: 4,  name: "John Doe" }, { id: 5,  name: "Jane Smith" }, { id: 6,  name: "ìµœë¯¼ìˆ˜" },
  { id: 7,  name: "í•œê°€ì¸" }, { id: 8,  name: "ì´ì¤€í˜¸" }, { id: 9,  name: "í™ê¸¸ë™" },
  { id:10,  name: "ê°•í•˜ëŠ˜" }, { id:11,  name: "ì†¡ì§€íš¨" }, { id:12,  name: "ìœ ì¬ì„" },
  { id:13,  name: "ì •í˜•ëˆ" }, { id:14,  name: "ë°•ëª…ìˆ˜" }, { id:15,  name: "ì´íš¨ë¦¬" },
  { id:16,  name: "ì•„ì´ìœ " }, { id:17,  name: "ì†í¥ë¯¼" }, { id:18,  name: "ê¹€ì—°ì•„" },
  { id:19,  name: "ì°¨ì€ìš°" }, { id:20,  name: "ì „ì§€í˜„" }
];
let teams = []; // {id, name, members: [], createdAt}

let foliceList = [
  { id: "F1", name: "banner.png", owner: "admin", status: "í™œì„±",   created: "2025-09-06" },
  { id: "F2", name: "hero.jpg",   owner: "admin", status: "ë¹„í™œì„±", created: "2025-09-01" },
];
let profoliosList = [
  { id: "P1", title: "ì›¹ í¬íŠ¸í´ë¦¬ì˜¤",   author: "ë°•ë²”ìˆ˜", tag: "#Landing", created: "2025-09-05" },
  { id: "P2", title: "ì–´ë“œë¯¼ ë¦¬ë””ìì¸", author: "ì´ì˜í¬", tag: "#Admin",   created: "2025-08-27" },
];
let usersList = [
  { id: 1, email: "user1@example.com",  nick: "ë²”ìˆ˜",   role: "USER",  joined: "2025-09-01" },
  { id: 2, email: "admin@example.com",  nick: "ê´€ë¦¬ì", role: "ADMIN", joined: "2025-09-02" },
];

/* ------------------ ê³µí†µ ì—˜ë¦¬ë¨¼íŠ¸ ------------------ */
const $title = document.getElementById("pageTitle");
const $sub = document.getElementById("pageSub");
const $panelTitle = document.getElementById("panelTitle");
const $panelCount = document.getElementById("panelCount");
const $panelBody = document.getElementById("panelBody");
const $panelFoot = document.getElementById("panelFoot");
const $rangeHint = document.getElementById("rangeHint");
const $pageIndex = document.getElementById("pageIndex");

/* ------------------ í˜ì´ì§€ í…ìŠ¤íŠ¸ ------------------ */
const pageMeta = {
  folice:     { title: "Folice ê´€ë¦¬",     sub: "íŒŒì¼/ë°°ë„ˆ ë“± Folice ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.", panelTitle: "Folice ëª©ë¡" },
  profolios:  { title: "Profolios ê´€ë¦¬",  sub: "í”„ë¡œì íŠ¸ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.",         panelTitle: "Profolios ëª©ë¡" },
  teams:      { title: "íŒ€ ê´€ë¦¬",          sub: "â€˜íŒ€ í¸ì„±â€™ê³¼ â€˜íŒ€ ê´€ë¦¬â€™ íƒ­ì—ì„œ ì‘ì—…í•˜ì„¸ìš”.",   panelTitle: "íŒ€" },
  users:      { title: "ìœ ì € ê´€ë¦¬",        sub: "ì‚¬ìš©ì ê³„ì •ê³¼ ê¶Œí•œì„ ê´€ë¦¬í•©ë‹ˆë‹¤.",           panelTitle: "ìœ ì € ëª©ë¡" }
};

/* ------------------ ì‚¬ì´ë“œë°” ------------------ */
document.querySelectorAll("#sidebar .rail-item").forEach(a => {
  a.addEventListener("click", (e) => {
    e.preventDefault();
    document.querySelectorAll("#sidebar .rail-item").forEach(x => x.classList.remove("is-active"));
    a.classList.add("is-active");
    loadPage(a.dataset.page);
  });
});

/* ------------------ í˜ì´ì§€ ë¡œë” ------------------ */
function loadPage(page) {
  const meta = pageMeta[page];
  $title.textContent = meta.title;
  $sub.textContent = meta.sub;
  $panelTitle.textContent = meta.panelTitle;

  if (page === "folice")     renderFolice();
  if (page === "profolios")  renderProfolios();
  if (page === "users")      renderUsers();
  if (page === "teams")      renderTeamsPage(); // âœ… íƒ­ êµ¬ì¡°
}

/* ------------------ Folice ------------------ */
function renderFolice() {
  $panelFoot.style.display = "none";
  $panelCount.textContent = `${foliceList.length}ê±´`;
  $panelBody.innerHTML = `
    <table class="table">
      <thead>
        <tr><th>ID</th><th>íŒŒì¼ëª…</th><th>ì—…ë¡œë”</th><th>ìƒíƒœ</th><th>ì—…ë¡œë“œì¼</th><th class="th-actions">ê´€ë¦¬</th></tr>
      </thead>
      <tbody>
        ${foliceList.map(f => `
          <tr>
            <td class="cell-strong">${f.id}</td>
            <td>${f.name}</td>
            <td>${f.owner}</td>
            <td>${f.status}</td>
            <td>${f.created}</td>
            <td class="td-actions">
              <button class="btn">ìˆ˜ì •</button>
              <button class="btn">ì‚­ì œ</button>
            </td>
          </tr>
        `).join("")}
      </tbody>
    </table>`;
}

/* ------------------ Profolios ------------------ */
function renderProfolios() {
  $panelFoot.style.display = "none";
  $panelCount.textContent = `${profoliosList.length}ê±´`;
  $panelBody.innerHTML = `
    <table class="table">
      <thead>
        <tr><th>ID</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>íƒœê·¸</th><th>ë“±ë¡ì¼</th><th class="th-actions">ê´€ë¦¬</th></tr>
      </thead>
      <tbody>
        ${profoliosList.map(p => `
          <tr>
            <td class="cell-strong">${p.id}</td>
            <td>${p.title}</td>
            <td>${p.author}</td>
            <td>${p.tag}</td>
            <td>${p.created}</td>
            <td class="td-actions">
              <button class="btn">ìˆ˜ì •</button>
              <button class="btn">ì‚­ì œ</button>
            </td>
          </tr>
        `).join("")}
      </tbody>
    </table>`;
}

/* ------------------ Users ------------------ */
function renderUsers() {
  $panelFoot.style.display = "none";
  $panelCount.textContent = `${usersList.length}ê±´`;
  $panelBody.innerHTML = `
    <table class="table">
      <thead>
        <tr><th>ID</th><th>ì´ë©”ì¼</th><th>ë‹‰ë„¤ì„</th><th>ì—­í• </th><th>ê°€ì…ì¼</th><th class="th-actions">ê´€ë¦¬</th></tr>
      </thead>
      <tbody>
        ${usersList.map(u => `
          <tr>
            <td class="cell-strong">${u.id}</td>
            <td>${u.email}</td>
            <td>${u.nick}</td>
            <td>${u.role}</td>
            <td>${u.joined}</td>
            <td class="td-actions">
              <button class="btn">ìˆ˜ì •</button>
              <button class="btn">ì‚­ì œ</button>
            </td>
          </tr>
        `).join("")}
      </tbody>
    </table>`;
}

/* ======================================================
   Teams â€“ íƒ­(íŒ€ í¸ì„± / íŒ€ ê´€ë¦¬) + ê°ê°ì˜ í™”ë©´ ë Œë”ëŸ¬
   ====================================================== */
let editingTeamId = null;

function renderTeamsPage(activeTab = "compose") {
  $panelFoot.style.display = "none";
  $panelTitle.textContent = "íŒ€";
  $panelCount.textContent = `${teams.length}íŒ€`;

  // íƒ­ + ì»¨í…Œì´ë„ˆ
  $panelBody.innerHTML = `
    <div class="tabbar" role="tablist">
      <button class="tab ${activeTab === "compose" ? "is-active":""}" data-tab="compose" role="tab" aria-selected="${activeTab==="compose"}">íŒ€ í¸ì„±</button>
      <button class="tab ${activeTab === "manage" ? "is-active":""}"  data-tab="manage"  role="tab" aria-selected="${activeTab==="manage"}">íŒ€ ê´€ë¦¬</button>
    </div>
    <div id="teamsTabContent"></div>
  `;

  // ì´ë²¤íŠ¸
  document.querySelectorAll(".tabbar .tab").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll(".tabbar .tab").forEach(b=>b.classList.remove("is-active"));
      btn.classList.add("is-active");
      const tab = btn.dataset.tab;
      renderTeamsTab(tab);
    });
  });

  // ì´ˆê¸° íƒ­
  renderTeamsTab(activeTab);
}

function renderTeamsTab(tab){
  const wrap = document.getElementById("teamsTabContent");
  if(tab === "compose"){
    renderTeamComposer(wrap);
  }else{
    renderTeamListView(wrap);
  }
}

/* ---------- íŒ€ í¸ì„± íƒ­ ---------- */
function renderTeamComposer(rootEl){
  rootEl.innerHTML = `
    <div class="team-manager">
      <!-- ì¢Œ: íšŒì› ëª©ë¡ -->
      <div class="team-column">
        <h3>íšŒì› ëª©ë¡</h3>
        <input type="search" id="memberSearch" placeholder="íšŒì› ê²€ìƒ‰" />
        <ul id="memberList" class="list-box"></ul>
      </div>

      <!-- ì¤‘ì•™: ì´ë™ ë²„íŠ¼ -->
      <div class="team-controls">
        <button id="btnAdd" class="btn">â–¶</button>
        <button id="btnRemove" class="btn">â—€</button>
      </div>

      <!-- ìš°: ì„ íƒëœ íŒ€ì› & ì €ì¥ -->
      <div class="team-column">
        <h3>ì„ íƒëœ íŒ€ì›</h3>
        <ul id="selectedList" class="list-box"></ul>
        <input type="text" id="teamName" placeholder="íŒ€ ì´ë¦„ ì…ë ¥" />
        <button id="btnSaveTeam" class="btn btn-teal full">${editingTeamId? "íŒ€ ìˆ˜ì • ì™„ë£Œ":"íŒ€ ì €ì¥"}</button>
      </div>
    </div>
  `;

  const $memberList   = document.getElementById("memberList");
  const $selectedList = document.getElementById("selectedList");
  const $memberSearch = document.getElementById("memberSearch");
  const $teamName     = document.getElementById("teamName");
  const $btnAdd       = document.getElementById("btnAdd");
  const $btnRemove    = document.getElementById("btnRemove");
  const $btnSaveTeam  = document.getElementById("btnSaveTeam");

  // í¸ì§‘ ëª¨ë“œë¼ë©´ ì±„ìš°ê¸°
  if(editingTeamId !== null){
    const t = teams.find(v=>v.id===editingTeamId);
    if(t){
      $teamName.value = t.name;
      t.members.forEach((nm,i)=>{
        const li = document.createElement("li");
        li.textContent = nm;
        li.dataset.id = "sel-"+i;
        $selectedList.appendChild(li);
      });
    }
  }

  function renderAllMembers(){
    const selectedNames = [...$selectedList.children].map(li => li.textContent);
    $memberList.innerHTML = "";
    allMembers.forEach(m=>{
      if(!selectedNames.includes(m.name)){
        const li=document.createElement("li");
        li.textContent=m.name;
        li.dataset.id=m.id;
        $memberList.appendChild(li);
      }
    });
  }
  function makeSelectable($ul){
    $ul.addEventListener("click", (e) => {
      if (e.target.tagName === "LI") {
        [...$ul.children].forEach(li => li.classList.remove("selected"));
        e.target.classList.add("selected");
      }
    });
  }

  $btnAdd.addEventListener("click", ()=>{
    const sel=$memberList.querySelector(".selected");
    if(!sel) return;
    sel.classList.remove("selected");
    $selectedList.appendChild(sel);
  });
  $btnRemove.addEventListener("click", ()=>{
    const sel=$selectedList.querySelector(".selected");
    if(!sel) return;
    sel.remove();
    renderAllMembers();
  });

  $btnSaveTeam.addEventListener("click", ()=>{
    const name = $teamName.value.trim();
    const members = [...$selectedList.children].map(li=>li.textContent);
    if(!name){ alert("íŒ€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!"); return; }
    if(members.length===0){ alert("íŒ€ì›ì„ ì„ íƒí•˜ì„¸ìš”!"); return; }

    if(editingTeamId !== null){
      const idx = teams.findIndex(t=>t.id===editingTeamId);
      if(idx>=0){ teams[idx].name=name; teams[idx].members=members; }
      editingTeamId = null;
    }else{
      const id=(teams.at(-1)?.id ?? 0)+1;
      const createdAt=new Date().toLocaleString();
      teams.push({ id, name, members, createdAt });
    }
    // ì™„ë£Œ í›„ â€˜íŒ€ ê´€ë¦¬â€™ íƒ­ìœ¼ë¡œ ì´ë™
    renderTeamsPage("manage");
  });

  $memberSearch.addEventListener("input", ()=>{
    const q = $memberSearch.value.toLowerCase();
    [...$memberList.children].forEach(li=>{
      li.style.display = li.textContent.toLowerCase().includes(q) ? "" : "none";
    });
  });

  makeSelectable($memberList);
  makeSelectable($selectedList);
  renderAllMembers();
}

/* ---------- íŒ€ ê´€ë¦¬ íƒ­ ---------- */
function renderTeamListView(rootEl){
  rootEl.innerHTML = `
    <div class="team-result">
      <h3>ì €ì¥ëœ íŒ€ ëª©ë¡</h3>
      <ul id="teamList"></ul>
    </div>
  `;
  const $teamList = document.getElementById("teamList");

  function draw(){
    $teamList.innerHTML = teams.map(t=>`
      <li>
        <div class="team-item">
          <div class="team-info">
            <div class="team-name">${t.name}</div>
            <div class="team-members">${t.members.join(", ")}</div>
            <div class="team-meta">${t.createdAt}</div>
          </div>
          <div class="team-actions">
            <button class="btn" data-act="edit" data-id="${t.id}">ìˆ˜ì •</button>
            <button class="btn danger" data-act="delete" data-id="${t.id}">ì‚­ì œ</button>
          </div>
        </div>
      </li>
    `).join("");
    $panelCount.textContent = `${teams.length}íŒ€`;
  }

  $teamList.addEventListener("click",(e)=>{
    const act = e.target.dataset.act;
    const id  = Number(e.target.dataset.id);
    if(!act || !id) return;

    if(act==="edit"){
      editingTeamId = id;      // í¸ì§‘ ëŒ€ìƒ ì €ì¥
      renderTeamsPage("compose"); // ğŸ‘‰ íŒ€ í¸ì„± íƒ­ìœ¼ë¡œ ì´ë™ + ë°ì´í„° ì£¼ì…
    }
    if(act==="delete"){
      if(!confirm("ì •ë§ ì´ íŒ€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      teams = teams.filter(t=>t.id!==id);
      draw();
    }
  });

  draw();
}

/* ------------------ ì´ˆê¸° ì§„ì… ------------------ */
loadPage("folice");
</script>

</body>
</html>
