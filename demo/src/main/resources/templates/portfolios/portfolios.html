<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title th:text="${portfolios != null} ? ${portfolios.title} : 'í¬íŠ¸í´ë¦¬ì˜¤ ì—†ìŒ'">Portfolio</title>
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />

  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/portfolios/portfolios-detail.css">
</head>
<body>
  <!-- í—¤ë” -->
  <div th:replace="fragments/header :: site-header"></div>

<main class="container">

  <!-- âŒ Not Found -->
  <div th:if="${notFound}" class="error-box">
    <h1>í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h1>
    <a href="/home">â† í™ˆìœ¼ë¡œ</a>
  </div>

  <!-- âœ… Portfolio Content -->
  <div th:if="${portfolios != null}" class="portfolio-detail-grid">

    <!-- ì™¼ìª½: ì´ë¯¸ì§€ -->
    <div class="gallery">
      <!-- ëŒ€í‘œ ì´ë¯¸ì§€ -->
      <figure class="main-photo">
        <img id="mainImage" th:src="${portfolios.screenshots[0]}" alt="ëŒ€í‘œ ì´ë¯¸ì§€">
      </figure>

      <!-- ì¸ë„¤ì¼ -->
      <div class="thumb-list">
        <img th:each="img : ${portfolios.screenshots}"
             th:src="${img}"
             alt="ì¸ë„¤ì¼"
             onmouseover="changeMainImage(this.src)">
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì •ë³´ -->
    <div class="info-box">
      <h1 class="title" th:text="${portfolios.title}">ì œëª©</h1>
      <p class="desc" th:text="${portfolios.desc}">ì„¤ëª…</p>

      <div class="meta-box">

        <p><span class="label">Link:</span>
          <a th:href="${portfolios.link}" target="_blank" th:text="${portfolios.link}" class="custom-link"></a>
        </p>

        <p><span class="label">Views:</span> <span id="viewCount">0</span></p>

        <!-- â¤ï¸ Likes: ë¼ë²¨ í…ìŠ¤íŠ¸ + í•˜íŠ¸ë§Œ í´ë¦­ -->
<p class="likes-line">
  <span class="label">Likes:</span>

  <!-- ë¡œê·¸ì¸ ìƒíƒœ: í•˜íŠ¸ ë²„íŠ¼ë§Œ í´ë¦­ ê°€ëŠ¥ -->
  <button sec:authorize="isAuthenticated()"
          id="likeBtn"
          class="heart-btn"
          title="ì¢‹ì•„ìš”"
          aria-label="ì¢‹ì•„ìš”"
          th:attr="data-id=${portfolios.id}">
    â¤ï¸
  </button>

  <!-- ë¹„íšŒì›: í•˜íŠ¸ í´ë¦­ ì‹œ ë¡œê·¸ì¸ìœ¼ë¡œ -->
  <a sec:authorize="isAnonymous()"
     href="/signin"
     id="likeSigninTrigger"
     class="heart-btn"
     title="ë¡œê·¸ì¸ í›„ ì¢‹ì•„ìš” ê°€ëŠ¥"
     aria-label="ë¡œê·¸ì¸ í›„ ì¢‹ì•„ìš”">
    â¤ï¸
  </a>

  <!-- ì¢‹ì•„ìš” ìˆ˜ëŠ” ë²„íŠ¼ ë°– í…ìŠ¤íŠ¸ -->
  <span id="likeCount" th:text="${portfolios.likes}">0</span>
</p>


        <!-- ğŸ· íƒœê·¸ -->
        <div class="tags">
          <span class="label">Tags:</span>
          <div class="tag-wrap">
            <a th:each="tag : ${portfolios.tags}"
               th:href="@{/home(q=${tag})}"
               th:text="${tag}"
               class="tag"></a>
          </div>
        </div>

        <!-- ë‹¤ìš´ë¡œë“œ -->
        <p><span class="label">Download:</span>
          <a th:href="${portfolios.download}" download th:text="${portfolios.download}" class="download-link"></a>
        </p>

        <!-- ì•„ì´ì½˜ -->
        <aside class="summary-logo" th:if="${portfolios.icon}">
          <figure class="logo-card" title="portfolios Logo">
            <img th:src="${portfolios.icon}"
                 th:alt="|${portfolios.title} ì•„ì´ì½˜|"
                 loading="lazy" decoding="async">
          </figure>
        </aside>
      </div>
    </div>
  </div>

  
 

  <div class="comment-section">
  <h2>ëŒ“ê¸€</h2>

  <!-- í‰ê·  ë³„ì (ëª¨ë‘ì—ê²Œ ë³´ì„) -->
  <div class="rating-summary">
    <div class="stars readonly" id="avgStars" aria-label="í‰ê·  ë³„ì "></div>
    <span class="star-symbol">â­</span>
    <span id="avgScore">0.0</span>
    <span class="count">(<span id="ratingCount">0</span>)</span>
  </div>

  <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì ì „ìš©: ë³„ì  + ëŒ“ê¸€ í¼ -->
  <div sec:authorize="isAuthenticated()">
    <div class="rate-input">
      <label class="rate-label">ë‚´ ë³„ì : </label>
      <div id="writeStars" class="stars write" role="radiogroup" aria-label="ë³„ì  ì„ íƒ(1~5)">
        <!-- JSê°€ 5ê°œ ë³„ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤ -->
      </div>
      <span id="myScoreText">0</span>/5
    </div>

    <form id="commentForm">
      <textarea id="commentContent" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." rows="4" required></textarea>
      <button type="submit">ë“±ë¡</button>
    </form>
  </div>

  <!-- ë¹„íšŒì› ì•ˆë‚´ -->
  <div sec:authorize="isAnonymous()">
    <p class="muted">ë¡œê·¸ì¸ í›„ ëŒ“ê¸€/ë³„ì ì„ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="/signin">ë¡œê·¸ì¸</a></p>
  </div>

  <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
  <div id="commentList" class="comments"></div>
</div>

</main>

<!-- ğŸ”— JavaScript -->
<script>
  function changeMainImage(src) {
    document.getElementById("mainImage").src = src;
  }
</script>
<script src="/js/portfolios/portfolios-detail.js"></script>
</body>
</html>
