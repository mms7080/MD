<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>계정 찾기</title>

  <!-- 공통 CSS -->
  <link rel="stylesheet" th:href="@{/css/header.css}" />
  <link rel="stylesheet" th:href="@{/css/footer.css}" />
  <link rel="stylesheet" th:href="@{/css/users/auth-modal.css}" />
  <link rel="stylesheet" th:href="@{/css/users/findsign.css}" />
 
  <script src="/js/users/find.js" defer></script>
</head>

<body>
  <!-- 공통 헤더 -->
  <th:block th:replace="~{fragments/header :: header('find')}"></th:block>

  <main class="kf-find">
    <h1 class="kf-find__title">계정 찾기</h1>

    <!-- 서버 플래시 메시지 -->
    <div th:if="${message}" class="kf-find__note" th:text="${message}"></div>
    <div th:if="${error}" class="kf-find__note error" th:text="${error}"></div>

    <!-- 탭 토글 (접근성 라디오) -->
    <input id="tab-id" type="radio" name="finder" value="id"
      th:checked="${#strings.equals(param.tab,'pw')} ? false : true">
    <input id="tab-pw" type="radio" name="finder" value="pw" th:checked="${#strings.equals(param.tab,'pw')}">

    <section class="kf-find__card" aria-label="아이디/비밀번호 찾기">
      <!-- 탭 헤더 -->
      <div class="kf-find__head" role="tablist">
        <label class="kf-find__tab" id="tab-id-label" role="tab" aria-controls="panel-id" aria-selected="true"
          for="tab-id">아이디 찾기</label>
        <label class="kf-find__tab" id="tab-pw-label" role="tab" aria-controls="panel-pw" aria-selected="false"
          for="tab-pw">비밀번호 변경</label>
      </div>

      <div class="kf-find__body">
        <!-- 아이디 찾기 -->
        <div id="panel-id" class="kf-find__panel" role="tabpanel" aria-labelledby="tab-id-label">
          <form class="kf-find__form" method="post" th:action="@{/forgot/id}">
            <label class="kf-find__label">이름
              <input class="kf-find__input" type="text" name="name" required autocomplete="name" />
            </label>
            <label class="kf-find__label">이메일
              <input class="kf-find__input" type="email" name="email" required autocomplete="email" />
              <span class="kf-find__help">가입 시 사용한 이메일을 입력하세요.</span>
            </label>
            <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
            <button class="kf-find__submit" type="submit">아이디 확인</button>
          </form>
        </div>

        <!-- 비밀번호 변경 1단계 -->
        <div id="panel-pw" class="kf-find__panel" role="tabpanel" aria-labelledby="tab-pw-label">
          <form class="kf-find__form" id="pwVerifyForm" method="post">
            <label class="kf-find__label">이름
              <input class="kf-find__input" type="text" name="name" id="pwName" required autocomplete="name" />
            </label>
            <label class="kf-find__label">아이디
              <input class="kf-find__input" type="text" name="username" id="pwUsername" required
                autocomplete="username" />
            </label>
            <label class="kf-find__label">이메일
              <input class="kf-find__input" type="email" name="email" id="pwEmail" required autocomplete="email" />
              <span class="kf-find__help">본인확인을 위해 이름/아이디/이메일을 모두 입력하세요.</span>
            </label>
            <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
            <button class="kf-find__submit" type="button" id="openPwModal">비밀번호 재설정</button>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- ===== 비밀번호 설정 모달 ===== -->
  <input type="checkbox" id="pwModalToggle" hidden>
  <div class="kf-modal" aria-hidden="true">
    <label class="kf-modal__overlay" for="pwModalToggle"></label>
    <div class="kf-modal__content" role="dialog" aria-modal="true" aria-labelledby="pw-modal-title">
      <header class="kf-modal__header">
        <h3 id="pw-modal-title">비밀번호 설정</h3>
        <label class="kf-modal__close" for="pwModalToggle" aria-label="닫기">×</label>
      </header>
      <section class="kf-modal__body">
        <div class="kf-modal__confirm">
          <div class="row"><span class="label">이름</span><span class="value" id="modalNameText">-</span></div>
        </div>
        <div class="kf-modal__confirm">
          <div class="row"><span class="label">아이디</span><span class="value" id="modalUsernameText">-</span></div>
        </div>

        <form id="pwResetForm" class="kf-find__form" method="post" th:action="@{/forgot/password}">
          <input type="hidden" name="name" id="modalName">
          <input type="hidden" name="username" id="modalUsername">
          <input type="hidden" name="email" id="modalEmail">

          <label class="kf-find__label">새 비밀번호
            <input class="kf-find__input" id="newPassword" type="password" name="newpassword" required minlength="10"
              autocomplete="new-password" placeholder="10자 이상" />
          </label>
          <label class="kf-find__label">새 비밀번호 확인
            <input class="kf-find__input" id="confirmPassword" type="password" name="confirmpassword" required
              autocomplete="new-password" placeholder="다시 입력" />
          </label>
          <small id="pwStatus" class="kf-find__note" hidden></small>

          <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
          <button id="pwSubmit" class="kf-find__submit" type="submit">비밀번호 변경</button>
        </form>
      </section>
    </div>
  </div>

  <!-- 공통 푸터 -->
  <th:block th:replace="~{fragments/footer :: footer}"></th:block>
</body>

</html>