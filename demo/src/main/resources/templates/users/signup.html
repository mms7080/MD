<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>회원가입 – kafolio</title>

  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/auth/signup.css" />
  <script src="/js/auth/signup.js" defer></script>
</head>

<body>
  <div th:replace="fragments/header :: site-header"></div>

  <main class="auth-wrap" role="main">
    <section class="auth-card" aria-labelledby="signupTitle">
      <header class="auth-head">
        <h1 id="signupTitle">회원가입</h1>
      </header>

      <p th:if="${msg}" th:text="${msg}" class="auth-alert is-success" role="status"></p>
      <p th:if="${error}" th:text="${error}" class="auth-alert is-error" role="alert"></p>
      <p id="ajaxNotice" class="auth-alert" role="status" style="display:none;"></p>

      <form th:action="@{/signup}" method="post" th:object="${usersDTO}" class="auth-form" id="signupForm">
        <div th:if="${#fields.hasAnyErrors()}">
          <ul>
            <li class="error" th:each="e : ${#fields.errors('*')}" th:text="${e}">에러</li>
          </ul>
        </div>

        <div></div>

        <div class="field">
          <label for="username">아이디</label>
          <div class="inline-field">
            <input id="username" type="text" th:field="*{username}" placeholder="영문 소문자/숫자 4~16자" required />
            <button type="button" class="btn btn-blue" id="btnCheckId">중복 확인</button>
          </div>
          <p id="usernameStatus" class="auth-alert" role="status" style="display:none;"></p>
          <div class="error" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
        </div>

        <div class="field">
          <label for="password">비밀번호</label>
          <input id="password" type="password" th:field="*{password}" placeholder="10자 이상" required />
          <div class="error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
        </div>

        <div class="field">
          <label for="confirmPassword">비밀번호 확인</label>
          <input id="confirmPassword" type="password" th:field="*{confirmPassword}" placeholder="비밀번호를 한번 더 입력"
            required />
          <div class="error" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
          <div id="pwMismatch" class="error" style="display:none;">비밀번호가 일치하지 않습니다.</div>
          <div id="pwOk" class="msg-ok" style="display:none;">비밀번호가 일치합니다.</div>
        </div>

        <div class="field">
          <label for="name">이름</label>
          <input id="name" type="text" th:field="*{name}"  required />
          <div class="error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
        </div>

        <div class="field">
          <label for="email">이메일</label>
          <div class="inline-field">
            <input id="email" type="email" th:field="*{email}" placeholder="your@email.com" required />
            <button type="button" class="btn btn-blue" id="btnSendCode">인증코드 발송</button>
          </div>
          <small class="hint">인증코드는 5분 동안 유효합니다.</small>
          <div class="error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
        </div>

        <h3 class="section-title">성별</h3>
        <div role="group" aria-label="성별 선택" class="gender-group">
          <label class="chk">
            <input type="checkbox" name="gender" id="genderM" value="M"
              th:checked="${usersDTO != null and usersDTO.gender == 'M'}" />
            <span>남자</span>
          </label>
          <label class="chk">
            <input type="checkbox" name="gender" id="genderW" value="W"
              th:checked="${usersDTO != null and usersDTO.gender == 'W'}" />
            <span>여자</span>
          </label>
        </div>
        <div class="error" th:if="${#fields.hasErrors('gender')}" th:errors="*{gender}"></div>

        <div class="field">
          <label for="age">나이</label>
          <input id="age" type="number" min="0" max="150" th:field="*{age}" required />
          <div class="error" th:if="${#fields.hasErrors('age')}" th:errors="*{age}"></div>
        </div>

        <h3 class="section-title">이메일 인증</h3>
        <div class="field">
          <label for="emailCode">인증코드</label>
          <input id="emailCode" type="text" name="emailCode" placeholder="메일로 받은 6자리 코드" required />
        </div>

        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" id="csrfTokenField" />
        <button type="submit" class="btn btn-blue full" id="submitBtn">가입하기</button>
      </form>

      <footer class="auth-foot">
        <span>이미 계정이 있으신가요?</span>
        <a th:href="@{/signin}" class="link-strong">로그인</a>
      </footer>
    </section>
  </main>
</body>

</html>