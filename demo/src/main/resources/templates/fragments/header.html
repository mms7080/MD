<!-- templates/fragments/header.html -->
<!DOCTYPE html>
<html
    lang="ko"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="https://www.thymeleaf.org/extras/spring-security"
>
    <head>
        <meta name="_csrf" th:content="${_csrf?.token}" />
        <meta name="_csrf_header" th:content="${_csrf?.headerName}" />
    </head>

    <th:block th:fragment="header(active)">
        <header class="kf-header">
            <div class="kf-header__inner">
                <!-- 왼쪽: 로고 + 1차 메뉴 -->
                <div class="kf-header__left">
                    <a class="kf-logo" th:href="@{/}" aria-label="kafolio 홈">
                        kafolio <span class="kf-star">✶</span>
                    </a>

                    <nav class="kf-nav" aria-label="주요 메뉴">
                        <ul>
                            <li>
                                <a
                                    th:href="@{/portfolios}"
                                    th:classappend="${active}=='portfolio' ? ' is-active' : null"
                                    >portfolio</a
                                >
                            </li>
                            <li>
                                <a
                                    th:href="@{/folios}"
                                    th:classappend="${active}=='folio' ? ' is-active' : null"
                                    >folio</a
                                >
                            </li>
                            <li>
                                <a
                                    th:href="@{/notice}"
                                    th:classappend="${active}=='notice' ? ' is-active' : null"
                                    >공지사항</a
                                >
                            </li>
                        </ul>
                    </nav>
                </div>

                <!-- 오른쪽: 테마 토글 + (folios 전용 액션(지움) or 기존 인증 메뉴) -->
                <div class="kf-header__right">
                    <!-- Sun/Moon 순수 CSS 토글 (그대로 유지) -->
                    <label
                        for="themeToggle"
                        class="themeToggle st-sunMoonThemeToggleBtn"
                        aria-label="다크/라이트 전환"
                    >
                        <input
                            type="checkbox"
                            id="themeToggle"
                            class="themeToggleInput"
                        />
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                            stroke="none"
                            aria-hidden="true"
                        >
                            <mask id="moon-mask">
                                <rect
                                    x="0"
                                    y="0"
                                    width="20"
                                    height="20"
                                    fill="white"
                                ></rect>
                                <circle
                                    cx="11"
                                    cy="3"
                                    r="8"
                                    fill="black"
                                ></circle>
                            </mask>
                            <circle
                                class="sunMoon"
                                cx="10"
                                cy="10"
                                r="8"
                                mask="url(#moon-mask)"
                            ></circle>
                            <g>
                                <circle
                                    class="sunRay sunRay1"
                                    cx="18"
                                    cy="10"
                                    r="1.5"
                                ></circle>
                                <circle
                                    class="sunRay sunRay2"
                                    cx="14"
                                    cy="16.928"
                                    r="1.5"
                                ></circle>
                                <circle
                                    class="sunRay sunRay3"
                                    cx="6"
                                    cy="16.928"
                                    r="1.5"
                                ></circle>
                                <circle
                                    class="sunRay sunRay4"
                                    cx="2"
                                    cy="10"
                                    r="1.5"
                                ></circle>
                                <circle
                                    class="sunRay sunRay5"
                                    cx="6"
                                    cy="3.1718"
                                    r="1.5"
                                ></circle>
                                <circle
                                    class="sunRay sunRay6"
                                    cx="14"
                                    cy="3.1718"
                                    r="1.5"
                                ></circle>
                            </g>
                        </svg>
                    </label>

                    <nav class="kf-auth" aria-label="오른쪽 메뉴">
                        <!-- 비로그인 -->
                        <div sec:authorize="isAnonymous()">
                            <label
                                for="modal-signin"
                                class="kf-link"
                                style="cursor: pointer"
                                >로그인</label
                            >
                            <label
                                for="modal-signup"
                                class="kf-link"
                                style="cursor: pointer"
                                >회원가입</label
                            >
                        </div>

                        <!-- 로그인(일반) -->
                        <div
                            sec:authorize="isAuthenticated() and !hasRole('ADMIN')"
                        >
                            <a class="kf-link" th:href="@{/mypage/home}"
                                >마이페이지</a
                            >
                            <form
                                th:action="@{/logout}"
                                method="post"
                                style="display: inline"
                            >
                                <button
                                    type="submit"
                                    class="kf-link"
                                    style="
                                        background: none;
                                        border: 0;
                                        padding: 0;
                                        cursor: pointer;
                                    "
                                >
                                    로그아웃
                                </button>
                            </form>
                        </div>

                        <!-- 로그인(관리자) -->
                        <div sec:authorize="hasRole('ADMIN')">
                            <a class="kf-link" th:href="@{/admin}"
                                >관리자페이지</a
                            >
                            <form
                                th:action="@{/logout}"
                                method="post"
                                style="display: inline"
                            >
                                <button
                                    type="submit"
                                    class="kf-link"
                                    style="
                                        background: none;
                                        border: 0;
                                        padding: 0;
                                        cursor: pointer;
                                    "
                                >
                                    로그아웃
                                </button>
                            </form>
                        </div>
                    </nav>
                </div>
            </div>
        </header>
        <!-- ✅ 추가 1: 모달 조각 포함 -->
        <th:block th:replace="~{fragments/modals :: authModals}"></th:block>

        <!-- ✅ 추가 2: 쿼리파라미터로 모달 자동 오픈 -->
        <script>
            (function () {
                var modal = new URLSearchParams(window.location.search).get(
                    "modal"
                );
                if (modal === "signin") {
                    var r = document.getElementById("modal-signin");
                    if (r) r.checked = true;
                } else if (modal === "signup") {
                    var r2 = document.getElementById("modal-signup");
                    if (r2) r2.checked = true;
                }
            })();
        </script>
    </th:block>
</html>
