<!DOCTYPE html>
<html
    lang="ko"
    xmlns:th="http://www.thymeleaf.org"
    th:fragment="layout (pageTitle, headerKey, activeMenu, content, css, js)"
>
    <head>
        <meta charset="utf-8" />
        <title th:text="|kafolio – ${pageTitle}|">kafolio</title>

        <meta name="_csrf" th:content="${_csrf?.token}" />
        <meta name="_csrf_header" th:content="${_csrf?.headerName}" />

        <!-- ✅ 첫 페인트 전에 저장된 테마 적용 (CSS보다 반드시 앞) -->
        <script>
            (function () {
                try {
                    var saved = localStorage.getItem("theme"); // 'light' | 'dark' | null
                    if (!saved) {
                        saved =
                            window.matchMedia &&
                            window.matchMedia("(prefers-color-scheme: light)")
                                .matches
                                ? "light"
                                : "dark";
                    }
                    if (saved === "light") {
                        document.documentElement.setAttribute(
                            "data-theme",
                            "light"
                        );
                    } else {
                        document.documentElement.removeAttribute("data-theme"); // 기본: 다크
                    }
                } catch (e) {}
            })();
        </script>

        <!-- ✅ 크리티컬 배경: CSS 로드 전에도 정확히 칠하기 (깜빡임 방지) -->
        <meta name="color-scheme" content="dark light" />
        <style>
            html {
                background: #0f1114;
            }
            html[data-theme="light"] {
                background: #f8fafc;
            }
        </style>

        <!-- 공통 CSS -->
        <link th:href="@{/css/header.css}" rel="stylesheet" />
        <link th:href="@{/css/footer.css}" rel="stylesheet" />
        <link th:href="@{/css/users/auth-modal.css}" rel="stylesheet" />

        <!-- 페이지 전용 CSS 슬롯 -->
        <th:block th:replace="${css} ?: ~{}"></th:block>
    </head>

    <body class="site">
        <!-- 공통 헤더 -->
        <div th:replace="~{fragments/modals :: authModals}"></div>
        <div th:replace="~{fragments/header :: header(${headerKey})}"></div>

        <!-- 페이지 콘텐츠 메인 슬롯 -->
        <main class="site-main" th:replace="${content}"></main>

        <!-- 공통 푸터 -->
        <div th:replace="~{fragments/footer :: footer}"></div>

        <!-- 페이지 전용 JS 슬롯 -->
        <th:block th:replace="${js} ?: ~{}"></th:block>
    </body>
</html>
